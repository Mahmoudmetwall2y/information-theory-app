<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Information Theory Project - Execution Interface</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            font-family: 'Inter', sans-serif;
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #38bdf8, #a855f7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .glass-card {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(148, 163, 184, 0.2);
        }
        
        .nav-blur {
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(20px);
        }
        
        .upload-zone {
            border: 2px dashed rgba(56, 189, 248, 0.3);
            transition: all 0.3s ease;
        }
        
        .upload-zone.dragover {
            border-color: rgba(56, 189, 248, 0.8);
            background: rgba(56, 189, 248, 0.1);
        }
        
        .pulse-glow {
            animation: pulse-glow 2s infinite;
        }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(56, 189, 248, 0.3); }
            50% { box-shadow: 0 0 40px rgba(56, 189, 248, 0.6); }
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        .status-pending { background: #6b7280; }
        .status-running { background: #fbbf24; animation: pulse 1s infinite; }
        .status-success { background: #34d399; }
        .status-error { background: #f87171; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .slide-in {
            opacity: 0;
            transform: translateY(30px);
        }
        
        .code-block {
            background: rgba(2, 6, 23, 0.9);
            border: 1px solid rgba(148, 163, 184, 0.2);
            font-family: 'Courier New', monospace;
        }
        
        .progress-bar {
            height: 4px;
            background: rgba(56, 189, 248, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #38bdf8, #a855f7);
            border-radius: 2px;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body class="bg-slate-900 text-gray-100 min-h-screen">
    <!-- Navigation -->
    <nav class="fixed top-0 w-full z-50 nav-blur border-b border-gray-700/50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-cyan-400 to-purple-500 rounded-lg flex items-center justify-center">
                        <i class="fas fa-code text-white text-lg"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold">Info Theory Project</h1>
                        <p class="text-xs text-gray-400">Execution Interface</p>
                    </div>
                </div>
                <div class="flex items-center space-x-8">
                    <a href="index.html" class="text-gray-300 hover:text-cyan-400 transition-colors">
                        <i class="fas fa-home mr-1"></i>Home
                    </a>
                    <a href="documentation.html" class="text-gray-300 hover:text-cyan-400 transition-colors">
                        <i class="fas fa-book mr-1"></i>Docs
                    </a>
                    <div class="flex items-center space-x-2 text-sm text-gray-400">
                        <span class="status-indicator status-pending" id="overall-status"></span>
                        <span id="status-text">Ready to process</span>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="pt-20 pb-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- Header -->
            <div class="text-center mb-12 slide-in">
                <h1 class="text-4xl lg:text-5xl font-bold mb-4">
                    <span class="gradient-text">Project Execution</span>
                </h1>
                <p class="text-xl text-gray-400 max-w-3xl mx-auto">
                    Upload your text file and configure parameters to run the complete 
                    Huffman compression and Hamming error correction pipeline.
                </p>
            </div>

            <!-- Main Interface -->
            <div class="grid lg:grid-cols-3 gap-8">
                <!-- Configuration Panel -->
                <div class="lg:col-span-1">
                    <div class="glass-card rounded-xl p-6 slide-in">
                        <h2 class="text-2xl font-bold mb-6 flex items-center">
                            <i class="fas fa-cog text-cyan-400 mr-3"></i>
                            Configuration
                        </h2>
                        
                        <!-- File Upload -->
                        <div class="mb-8">
                            <label class="block text-sm font-medium mb-3">Upload Text File</label>
                            <div class="upload-zone relative rounded-lg p-8 text-center cursor-pointer" id="upload-zone">
                                <div class="mb-4 pointer-events-none">
                                    <i class="fas fa-cloud-upload-alt text-4xl text-cyan-400 mb-4"></i>
                                    <p class="text-gray-300 mb-2">Drag & drop your file here</p>
                                    <p class="text-sm text-gray-500">or click to browse</p>
                                </div>
                                <input type="file" id="file-input" accept=".txt"
                                       class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" aria-label="Upload text file">
                                <div id="file-info" class="hidden">
                                    <div class="bg-slate-700 rounded-lg p-4 text-left">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <p class="font-medium" id="file-name"></p>
                                                <p class="text-sm text-gray-400" id="file-size"></p>
                                            </div>
                                            <button id="remove-file" class="text-red-400 hover:text-red-300">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Parameters -->
                        <div class="mb-8">
                            <label class="block text-sm font-medium mb-3">Error Interval</label>
                            <div class="space-y-3">
                                <input type="range" id="error-interval" min="1" max="100" value="50" 
                                       class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer">
                                <div class="flex justify-between text-sm text-gray-400">
                                    <span>1 bit</span>
                                    <span id="interval-value">50 bits</span>
                                    <span>100 bits</span>
                                </div>
                            </div>
                            <p class="text-xs text-gray-500 mt-2">
                                Flip one bit every N bits in the Hamming stream
                            </p>
                        </div>

                        <!-- Sample Files -->
                        <div class="mb-8">
                            <label class="block text-sm font-medium mb-3">Quick Start</label>
                            <div class="space-y-2">
                                <button class="w-full text-left p-3 bg-slate-700 hover:bg-slate-600 rounded-lg transition-colors sample-file" data-content="Hello World! This is a sample text for Huffman encoding demonstration.">
                                    <div class="flex items-center">
                                        <i class="fas fa-file-alt text-cyan-400 mr-3"></i>
                                        <div>
                                            <p class="font-medium">Sample Text 1</p>
                                            <p class="text-xs text-gray-400">Simple demonstration</p>
                                        </div>
                                    </div>
                                </button>
                                <button class="w-full text-left p-3 bg-slate-700 hover:bg-slate-600 rounded-lg transition-colors sample-file" data-content="Information theory is a mathematical study of information storage and communication. It was originally proposed by Claude Shannon in 1948 to find fundamental limits on signal processing and communication operations.">
                                    <div class="flex items-center">
                                        <i class="fas fa-file-alt text-purple-400 mr-3"></i>
                                        <div>
                                            <p class="font-medium">Sample Text 2</p>
                                            <p class="text-xs text-gray-400">Information theory context</p>
                                        </div>
                                    </div>
                                </button>
                            </div>
                        </div>

                        <!-- Execute Button -->
                        <button id="run-pipeline" disabled 
                                class="w-full bg-gradient-to-r from-cyan-500 to-purple-600 px-6 py-4 rounded-lg text-white font-semibold hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed pulse-glow">
                            <i class="fas fa-play mr-2"></i>
                            Run Pipeline
                        </button>
                    </div>
                </div>

                <!-- Results Panel -->
                <div class="lg:col-span-2">
                    <div class="glass-card rounded-xl p-6 slide-in">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-2xl font-bold flex items-center">
                                <i class="fas fa-chart-bar text-purple-400 mr-3"></i>
                                Results
                            </h2>
                            <div class="flex items-center space-x-2 text-sm text-gray-400">
                                <span class="status-indicator status-pending" id="pipeline-status"></span>
                                <span id="pipeline-status-text">Waiting for input</span>
                            </div>
                        </div>

                        <!-- Progress Bar -->
                        <div class="mb-8" id="progress-container" style="display: none;">
                            <div class="flex justify-between text-sm mb-2">
                                <span>Processing Progress</span>
                                <span id="progress-percentage">0%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                            </div>
                        </div>

                        <!-- Status Cards -->
                        <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                            <div class="bg-slate-700/50 rounded-lg p-4 text-center">
                                <div class="text-2xl font-bold text-cyan-400" id="symbol-count">-</div>
                                <div class="text-sm text-gray-400">Symbols</div>
                            </div>
                            <div class="bg-slate-700/50 rounded-lg p-4 text-center">
                                <div class="text-2xl font-bold text-purple-400" id="encoded-bits">-</div>
                                <div class="text-sm text-gray-400">Encoded Bits</div>
                            </div>
                            <div class="bg-slate-700/50 rounded-lg p-4 text-center">
                                <div class="text-2xl font-bold text-green-400" id="hamming-bits">-</div>
                                <div class="text-sm text-gray-400">Hamming Bits</div>
                            </div>
                            <div class="bg-slate-700/50 rounded-lg p-4 text-center">
                                <div class="text-2xl font-bold text-yellow-400" id="compression-ratio">-</div>
                                <div class="text-sm text-gray-400">Compression</div>
                            </div>
                        </div>

                        <!-- 6-Stage Processing Pipeline -->
                        <div class="mb-8">
                            <h3 class="text-xl font-bold mb-4 text-center">
                                <span class="gradient-text">6-Stage Processing Pipeline</span>
                            </h3>
                            <div class="space-y-3">
                                <div class="flex items-center p-3 bg-slate-700/30 rounded-lg">
                                    <div class="w-8 h-8 bg-cyan-500 rounded-full flex items-center justify-center text-white font-bold text-sm mr-4">1</div>
                                    <div>
                                        <div class="font-semibold text-cyan-400">Symbol Analysis</div>
                                        <div class="text-sm text-gray-400">Calculate character probabilities and frequencies</div>
                                    </div>
                                </div>
                                <div class="flex items-center p-3 bg-slate-700/30 rounded-lg">
                                    <div class="w-8 h-8 bg-cyan-500 rounded-full flex items-center justify-center text-white font-bold text-sm mr-4">2</div>
                                    <div>
                                        <div class="font-semibold text-cyan-400">Huffman Encoding</div>
                                        <div class="text-sm text-gray-400">Build optimal prefix tree and generate codes</div>
                                    </div>
                                </div>
                                <div class="flex items-center p-3 bg-slate-700/30 rounded-lg">
                                    <div class="w-8 h-8 bg-cyan-500 rounded-full flex items-center justify-center text-white font-bold text-sm mr-4">3</div>
                                    <div>
                                        <div class="font-semibold text-cyan-400">Huffman Decoding</div>
                                        <div class="text-sm text-gray-400">Decode compressed bitstream back to text</div>
                                    </div>
                                </div>
                                <div class="flex items-center p-3 bg-slate-700/30 rounded-lg">
                                    <div class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center text-white font-bold text-sm mr-4">4</div>
                                    <div>
                                        <div class="font-semibold text-purple-400">Hamming Encoding</div>
                                        <div class="text-sm text-gray-400">Add error correction codes (7,4) to bitstream</div>
                                    </div>
                                </div>
                                <div class="flex items-center p-3 bg-slate-700/30 rounded-lg">
                                    <div class="w-8 h-8 bg-red-500 rounded-full flex items-center justify-center text-white font-bold text-sm mr-4">5</div>
                                    <div>
                                        <div class="font-semibold text-red-400">Error Simulation</div>
                                        <div class="text-sm text-gray-400">Inject bit errors and decode without correction</div>
                                    </div>
                                </div>
                                <div class="flex items-center p-3 bg-slate-700/30 rounded-lg">
                                    <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white font-bold text-sm mr-4">6</div>
                                    <div>
                                        <div class="font-semibold text-green-400">Error Correction</div>
                                        <div class="text-sm text-gray-400">Detect and correct errors using Hamming codes</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Pipeline Outputs -->
                        <div class="mb-8" id="pipeline-output" style="display: none;">
                            <h3 class="text-xl font-bold mb-4 text-center text-cyan-300">Pipeline Results</h3>
                            <div class="space-y-4">
                                <div class="bg-slate-800/70 rounded-lg p-4">
                                    <div class="flex items-center mb-2">
                                        <div class="w-8 h-8 bg-cyan-500 rounded-full flex items-center justify-center text-white font-bold text-sm mr-3">1</div>
                                        <div class="font-semibold">Symbol Analysis</div>
                                    </div>
                                    <div class="text-sm text-gray-300" id="probabilities"></div>
                                </div>
                                <div class="bg-slate-800/70 rounded-lg p-4">
                                    <div class="flex items-center mb-2">
                                        <div class="w-8 h-8 bg-cyan-500 rounded-full flex items-center justify-center text-white font-bold text-sm mr-3">2</div>
                                        <div class="font-semibold">Huffman Encoding</div>
                                    </div>
                                    <pre class="text-xs bg-slate-900/80 p-3 rounded-lg overflow-x-auto" id="encoded-preview">-</pre>
                                </div>
                                <div class="bg-slate-800/70 rounded-lg p-4">
                                    <div class="flex items-center mb-2">
                                        <div class="w-8 h-8 bg-cyan-500 rounded-full flex items-center justify-center text-white font-bold text-sm mr-3">3</div>
                                        <div class="font-semibold">Huffman Decoding</div>
                                    </div>
                                    <pre class="text-sm bg-slate-900/80 p-3 rounded-lg overflow-x-auto" id="decoded-preview">-</pre>
                                </div>
                                <div class="bg-slate-800/70 rounded-lg p-4">
                                    <div class="flex items-center mb-2">
                                        <div class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center text-white font-bold text-sm mr-3">4</div>
                                        <div class="font-semibold">Hamming Encoding</div>
                                    </div>
                                    <pre class="text-xs bg-slate-900/80 p-3 rounded-lg overflow-x-auto" id="hamming-preview">-</pre>
                                </div>
                                <div class="bg-slate-800/70 rounded-lg p-4">
                                    <div class="flex items-center mb-2">
                                        <div class="w-8 h-8 bg-red-500 rounded-full flex items-center justify-center text-white font-bold text-sm mr-3">5</div>
                                        <div class="font-semibold">Error Simulation</div>
                                    </div>
                                    <pre class="text-xs bg-slate-900/80 p-3 rounded-lg overflow-x-auto" id="corrupted-preview">-</pre>
                                    <p class="text-xs text-gray-400 mt-2">Decoded (without correction): <span id="corrupted-decode">-</span></p>
                                </div>
                                <div class="bg-slate-800/70 rounded-lg p-4">
                                    <div class="flex items-center mb-2">
                                        <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white font-bold text-sm mr-3">6</div>
                                        <div class="font-semibold">Error Correction</div>
                                    </div>
                                    <pre class="text-xs bg-slate-900/80 p-3 rounded-lg overflow-x-auto" id="recovered-preview">-</pre>
                                    <p class="text-xs text-gray-400 mt-2">Recovered Text: <span id="recovered-text">-</span></p>
                                </div>
                            </div>
                        </div>

                        <!-- Results Summary -->
                        <div class="bg-slate-700/50 rounded-lg p-4">
                            <h4 class="font-semibold text-cyan-400 mb-3">Processing Summary</h4>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Original Length:</span>
                                    <span id="original-length">-</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Encoded Length:</span>
                                    <span id="encoded-length">-</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Hamming Length:</span>
                                    <span id="hamming-length">-</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Pad Bits:</span>
                                    <span id="pad-bits">-</span>
                                </div>
                                <div class="border-t border-gray-600 pt-2 mt-2">
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Huffman OK:</span>
                                        <span id="huffman-ok">-</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Hamming OK:</span>
                                        <span id="hamming-ok">-</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Recovered OK:</span>
                                        <span id="recovered-ok">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-slate-900 py-8 border-t border-gray-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <div class="flex items-center justify-center space-x-3 mb-4">
                    <div class="w-10 h-10 bg-gradient-to-br from-cyan-400 to-purple-500 rounded-lg flex items-center justify-center">
                        <i class="fas fa-code text-white text-lg"></i>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold">Information Theory Project</h3>
                        <p class="text-sm text-gray-400">Academic Excellence in Computer Science</p>
                    </div>
                </div>
                <p class="text-gray-500 text-sm">
                    Â© 2025 Information Theory Project. Advanced algorithms and data processing.
                </p>
            </div>
        </div>
    </footer>

    <script src="main.js"></script>
    <script>
        // Project-specific functionality
        document.addEventListener('DOMContentLoaded', function() {
            initProjectInterface();
        });

        function initProjectInterface() {
            initFileUpload();
            initParameters();
            initSampleFiles();
        }

        function initFileUpload() {
            const uploadZone = document.getElementById('upload-zone');
            const fileInput = document.getElementById('file-input');
            const fileInfo = document.getElementById('file-info');
            const fileName = document.getElementById('file-name');
            const fileSize = document.getElementById('file-size');
            const removeFile = document.getElementById('remove-file');
            const runButton = document.getElementById('run-pipeline');

            uploadZone.addEventListener('click', () => fileInput.click());
            
            uploadZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadZone.classList.add('dragover');
            });

            uploadZone.addEventListener('dragleave', () => {
                uploadZone.classList.remove('dragover');
            });

            uploadZone.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadZone.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileSelect(files[0]);
                }
            });

            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFileSelect(e.target.files[0]);
                }
            });

            removeFile.addEventListener('click', () => {
                fileInput.value = '';
                fileInfo.classList.add('hidden');
                uploadZone.querySelector('div').style.display = 'block';
                runButton.disabled = true;
            });

            function handleFileSelect(file) {
                if (file.type === 'text/plain' || file.name.endsWith('.txt')) {
                    fileName.textContent = file.name;
                    fileSize.textContent = `${(file.size / 1024).toFixed(2)} KB`;
                    fileInfo.classList.remove('hidden');
                    uploadZone.querySelector('div').style.display = 'none';
                    runButton.disabled = false;
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const content = e.target.result;
                        window.uploadedFileContent = content;
                    };
                    reader.readAsText(file);
                } else {
                    alert('Please select a text file (.txt)');
                }
            }
        }

        function initParameters() {
            const slider = document.getElementById('error-interval');
            const valueDisplay = document.getElementById('interval-value');

            slider.addEventListener('input', (e) => {
                valueDisplay.textContent = `${e.target.value} bits`;
            });
        }

        function initSampleFiles() {
            const sampleButtons = document.querySelectorAll('.sample-file');
            
            sampleButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const content = button.dataset.content;
                    const blob = new Blob([content], { type: 'text/plain' });
                    const file = new File([blob], 'sample.txt', { type: 'text/plain' });
                    
                    const fileInput = document.getElementById('file-input');
                    const dt = new DataTransfer();
                    dt.items.add(file);
                    fileInput.files = dt.files;
                    
                    const fileName = document.getElementById('file-name');
                    const fileSize = document.getElementById('file-size');
                    const fileInfo = document.getElementById('file-info');
                    const uploadZone = document.getElementById('upload-zone');
                    const runButton = document.getElementById('run-pipeline');
                    
                    fileName.textContent = file.name;
                    fileSize.textContent = `${(file.size / 1024).toFixed(2)} KB`;
                    fileInfo.classList.remove('hidden');
                    uploadZone.querySelector('div').style.display = 'none';
                    runButton.disabled = false;
                    
                    window.uploadedFileContent = content;
                });
            });
        }

        // Real pipeline execution with Flask backend integration
        document.getElementById('run-pipeline').addEventListener('click', async function() {
            if (!window.uploadedFileContent) {
                alert('Please upload a text file first');
                return;
            }
            
            const button = this;
            const progressContainer = document.getElementById('progress-container');
            const progressFill = document.getElementById('progress-fill');
            const progressPercentage = document.getElementById('progress-percentage');
            const statusText = document.getElementById('status-text');
            const pipelineStatus = document.getElementById('pipeline-status');
            const pipelineStatusText = document.getElementById('pipeline-status-text');

            button.disabled = true;
            button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Processing...';
            progressContainer.style.display = 'block';
            statusText.textContent = 'Processing pipeline...';
            pipelineStatus.className = 'status-indicator status-running';
            pipelineStatusText.textContent = 'Running';

            try {
                const errorInterval = parseInt(document.getElementById('error-interval').value);
                
                let progress = 0;
                const progressInterval = setInterval(() => {
                    progress += Math.random() * 15;
                    if (progress > 95) progress = 95;
                    progressFill.style.width = `${progress}%`;
                    progressPercentage.textContent = `${Math.round(progress)}%`;
                }, 200);

                const response = await fetch('/api/process', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        text: window.uploadedFileContent,
                        error_interval: errorInterval
                    })
                });

                clearInterval(progressInterval);

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
                }

                const results = await response.json();
                
                progressFill.style.width = '100%';
                progressPercentage.textContent = '100%';

                displayResults(results);
                
                setTimeout(() => {
                    button.disabled = false;
                    button.innerHTML = '<i class="fas fa-play mr-2"></i>Run Pipeline';
                    progressContainer.style.display = 'none';
                    statusText.textContent = 'Processing complete';
                    pipelineStatus.className = 'status-indicator status-success';
                    pipelineStatusText.textContent = 'Completed';
                }, 500);

            } catch (error) {
                console.error('Error:', error);
                alert(`Processing failed: ${error.message}`);
                button.disabled = false;
                button.innerHTML = '<i class="fas fa-play mr-2"></i>Run Pipeline';
                progressContainer.style.display = 'none';
                statusText.textContent = 'Processing failed';
                pipelineStatus.className = 'status-indicator status-error';
                pipelineStatusText.textContent = 'Error';
            }
        });

        function displayResults(results) {
            const summary = results.summary;
            const metrics = results.quality_metrics;

            document.getElementById('symbol-count').textContent = summary.original_length;
            document.getElementById('encoded-bits').textContent = summary.encoded_length;
            document.getElementById('hamming-bits').textContent = summary.hamming_length;
            document.getElementById('compression-ratio').textContent = summary.compression_ratio;
            
            document.getElementById('original-length').textContent = `${summary.original_length} symbols`;
            document.getElementById('encoded-length').textContent = `${summary.encoded_length} bits`;
            document.getElementById('hamming-length').textContent = `${summary.hamming_length} bits`;
            document.getElementById('pad-bits').textContent = summary.pad_bits;
            
            const huffmanOkElement = document.getElementById('huffman-ok');
            const hammingOkElement = document.getElementById('hamming-ok');
            const recoveredOkElement = document.getElementById('recovered-ok');
            
            huffmanOkElement.textContent = metrics.huffman_ok ? 'True' : 'False';
            huffmanOkElement.className = metrics.huffman_ok ? 'text-green-400' : 'text-red-400';
            
            hammingOkElement.textContent = metrics.hamming_ok ? 'True' : 'False';
            hammingOkElement.className = metrics.hamming_ok ? 'text-green-400' : 'text-red-400';

            recoveredOkElement.textContent = metrics.recovered_text_ok ? 'True' : 'False';
            recoveredOkElement.className = metrics.recovered_text_ok ? 'text-green-400' : 'text-red-400';

            // Populate pipeline outputs
            const probabilitiesEl = document.getElementById('probabilities');
            if (results.top_probabilities?.length) {
                const listItems = results.top_probabilities
                    .map(([char, prob]) => `<li class="flex justify-between"><span class="text-gray-400">${char === ' ' ? '(space)' : char}</span><span class="text-cyan-300 font-mono">${prob.toFixed(4)}</span></li>`)
                    .join('');
                probabilitiesEl.innerHTML = `<ul class="space-y-1">${listItems}</ul>`;
            } else {
                probabilitiesEl.textContent = 'No probability data available.';
            }

            document.getElementById('encoded-preview').textContent = results.encoded_bits_preview || '-';
            document.getElementById('decoded-preview').textContent = results.decoded_text_preview || '-';
            document.getElementById('hamming-preview').textContent = results.hamming_bits_preview || '-';
            document.getElementById('corrupted-preview').textContent = results.corrupted_bits_preview || '-';
            document.getElementById('corrupted-decode').textContent = results.corrupted_decoded_preview || '-';
            document.getElementById('recovered-preview').textContent = results.recovered_bits_preview || '-';
            document.getElementById('recovered-text').textContent = results.recovered_decoded_preview || '-';

            document.getElementById('pipeline-output').style.display = 'block';
        }
    </script>
</body>
</html>
